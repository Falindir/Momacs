<div>
  <canvas id="canvas" width="800" height="600" style="cursor:crosshair;"></canvas>
</div>

<script>
            
              
$("#canvas").click(function(e){
    getPosition(e); 
});

var pointSize = 3;

var ima2D = null;

/**
 * Object Image2D
 **/
function Image2D(path, image) {
  this.path = path;
  this.segmentID = 0;
  this.arraySegment2D = [];
  this.pointID = 0;
  this.arrayPoint2D = [];
  this.image = image;
  this.finish = false;
}

/**
 * Object Segment2D
 **/
function Segment2D(id, p1, p2) {
  this.id = id;
  this.p1 = p1;
  this.p2 = p2;
}

/**
 * Object Point2D  
 **/
function Point2D(id, x,y) {
  this.id = id;
  this.x = x;
  this.y = y;
}

function Partition(id, type) {
   this.id = id;
   this.type = type;
   this.size = 0;
   this.content = [];
}

function printPoint2D(point) {
  var res = "Point2D-{id : " + point.id + "; x : " + point.x + "; y : " + point.y + "}\n";
  console.log(res);
}

/**
 * @param part : Partition 
 * @param element : Point2D or Segment2D or 
 **/
function addElementToPartition(part, element) {
  
  
}

function getPosition(event){
  if(ima2D) {
    var rect = canvas.getBoundingClientRect();
    var x = event.clientX - rect.left; // x == the location of the click in the document - the location (relative to the left) of the canvas in the document
    var y = event.clientY - rect.top; // y == the location of the click in the document - the location (relative to the top) of the canvas in the document
    var p = new Point2D(ima2D.pointID, x, y);
    ima2D.arrayPoint2D[ima2D.pointID] = p;
    drawCoordinates(x,y);
    if(ima2D.pointID > 0) {
      drawSegment(ima2D.arrayPoint2D[ima2D.pointID-1], p);
    } 
    ima2D.pointID++;
  }
}

function drawCoordinates(x,y){
        console.log("draw point" + x + " - " + y);
        
        var ctx = document.getElementById("canvas").getContext("2d");
        ctx.fillStyle = "#ff2626"; // Red color
        ctx.beginPath(); //Start path
        ctx.arc(x, y, pointSize, 0, Math.PI * 2, true); // Draw a point using the arc function of the canvas with a point structure.
        //ctx.stroke();
        ctx.fill(); // Close the path and fill.
}

function drawSegment(p1, p2) {
    var ctx = document.getElementById("canvas").getContext("2d");
    ctx.beginPath();
    ctx.moveTo( p1.x, p1.y);
    ctx.lineTo(p2.x, p2.y);
    ctx.strokeStyle = "#ff2626";
    ctx.lineWidth = 2;
    ctx.stroke();
    ctx.fill();
    var seg2D = new Segment2D(ima2D.segmentID, p1, p2);
    ima2D.arraySegment2D[ima2D.segmentID] = seg2D;
    ima2D.segmentID++;
}

function drawLastSegment() {
  if(ima2D) {
    if(ima2D.pointID > 2) { //minimum 3 points
        drawSegment(ima2D.arrayPoint2D[0], ima2D.arrayPoint2D[ima2D.pointID-1]);
    } else {
       alert("We need minimum 3 points");
    }
  }
}

function drawPoint(p) {
   ima2D.arrayPoint2D[ima2D.pointID] = p;
   drawCoordinates(p.x, p.y);
   ima2D.pointID++;
}

function deleteLastElement() {
    if(ima2D) {
      
        var segmentID = ima2D.segmentID;
        var arraySegment2D = ima2D.arraySegment2D;
        
        for (var i = 0; i < segmentID; i++) {
          var s = ima2D.arraySegment2D[i];
          arraySegment2D[i] = new Segment2D(s.id, s.p1, s.p2);
        }
        
        var pointID = ima2D.pointID;
        var arrayPoint2D = [];
        for (var i = 0; i < pointID; i++) {
           var p = ima2D.arrayPoint2D[i];
           arrayPoint2D[i] = new Point2D(p.id, p.x, p.y);
        }
      
        var path = ima2D.path;

        var canvas = document.getElementById("canvas");
        var ctx = document.getElementById('canvas');
        
        ctx = ctx.getContext('2d');
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

       
        var img1 = new Image();
        
        img1.onload = function () {
     
            ctx.drawImage(img1, 0, 0);
                        ctx.fillStyle = "rgba(127, 140, 141, 0.2)";
            ctx.fillRect(0, 0, 800, 600);
  
            for (var i = 0; i < pointID - 1; i++) {
              drawPoint(arrayPoint2D[i]);
            }
         
             for (var i = 0; i < segmentID - 1; i++) {
                drawSegment(arraySegment2D[i].p1, arraySegment2D[i].p2);
             }
        };
        
              img1.src = path;
      
              ima2D = new Image2D(path, img1);
         

    }
}


function drawImage(path) {
  
  var canvas = document.getElementById("canvas");
  var ctx = document.getElementById('canvas');

  if (ctx.getContext) {
    
        ctx = ctx.getContext('2d');
        ctx.setTransform(1, 0, 0, 1, 0, 0);
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        //Loading of the home test image - img1
        var img1 = new Image();

        //drawing of the test image - img1
        img1.onload = function () {
            //draw background image
            ctx.drawImage(img1, 0, 0);
            //draw a box over the top
            ctx.fillStyle = "rgba(127, 140, 141, 0.2)";
            ctx.fillRect(0, 0, 800, 600);

        };
        
      imageLoad = true;
        
      img1.src = path;
      
      ima2D = new Image2D(path, img1);
    
  }
}
  </script>